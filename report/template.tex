\documentclass{article}
\usepackage{amsmath}
\usepackage{booktabs}
\usepackage{color}
\usepackage{graphicx}
\usepackage{listings}
\usepackage{pgfplotstable}
\usepackage{pgfplots}
\usepackage{siunitx}
\usepackage{tikz}
\usepackage{csvsimple}

\lstset{
  language=Perl,
  basicstyle=\small\sffamily,
  numbers=left,
  numberstyle=\tiny,
  frame=tb,
  tabsize=4,
  columns=fixed,
  showstringspaces=false,
  showtabs=false,
  keepspaces,
  commentstyle=\color{red},
  keywordstyle=\color{blue}
}

\pgfplotsset{compat=newest} % place the legend below the plot
\usepgfplotslibrary{units} % display units nicely

\sisetup{round-mode = places, round-precision = 2}

\title{Penetration Test Report}
%\date{}
\author{Mo Khan}

\begin{document}
\pagenumbering{gobble}
\maketitle
\newpage
\tableofcontents
\newpage
\pagenumbering{arabic}

\section{Executive Summary}

Hello World!

\subsection{Summary of Results}

Structuring a document is easy!

\subsubsection{Subsubsection}

More text.

\paragraph{Paragraph}

Some more text.

\subparagraph{Subparagraph}

Even more text.

%\newpage
%\section{Attack Narrative}
%\subsection{Wordpress Exploitation}
%\subsection{Wordpress Plugin Unintended File Type Upload}
%\subsection{Linux Local Privilege Escalation}
%\subsection{Maintaining Access to Compromised Webserver}
%\subsection{Vulnerable Splunk Installation}
%\subsection{Domain Privilege Escalation}
%\subsection{Attacker Control of Archmake Transactions}

\newpage
\section{Recon}
\subsection{Information}

In order to get an understanding of what hosts are active on the network the first step 
I took was to find out what ip address the DHCP server assigned to my backtrack host using 
ifconfig\footnote{\label{ifconfig}ifconfig -- configure network interface parameters} 

\begin{lstlisting}[language=Bash, firstline=1, lastline=3]
root@bt-was:~/# ifconfig eth0
eth0      Link encap:Ethernet  HWaddr 00:0c:29:4b:5c:be  
          inet addr:10.2.1.30  Bcast:10.2.1.31  Mask:255.255.255.224
          inet6 addr: fe80::20c:29ff:fe4b:5cbe/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:472581 errors:0 dropped:0 overruns:0 frame:0
          TX packets:435725 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:258604722 (258.6 MB)  TX bytes:92862199 (92.8 MB)
          Interrupt:19 Base address:0x2000 
\end{lstlisting}

\subsubsection{DNS}

I used nmap\footnote{\label{nmap}nmap - Network exploration tool and security / port scanner} 
to do a ping sweep of the active hosts in the 
10.2.1.0/24 CIDR range.

\begin{lstlisting}[language=Bash, firstline=1, lastline=1]
root@bt-was:~/scans# nmap -sP 10.2.1.0/24

Starting Nmap 6.01 ( http://nmap.org ) at 2016-02-12 09:51 EST
Nmap scan report for metasploitable.sait230.ca (10.2.1.1)
Host is up (0.00029s latency).
MAC Address: 00:0C:29:B8:82:E1 (VMware)
Nmap scan report for websecdojo.sait230.ca (10.2.1.2)
Host is up (0.00027s latency).
MAC Address: 00:0C:29:2A:C8:AF (VMware)
Nmap scan report for ultimatelamp.sait230.ca (10.2.1.3)
Host is up (0.00016s latency).
MAC Address: 00:0C:29:23:94:3C (VMware)
Nmap scan report for samurai.sait230.ca (10.2.1.4)
Host is up (0.00038s latency).
MAC Address: 00:0C:29:A9:4F:36 (VMware)
Nmap scan report for nessus.sait230.ca (10.2.1.5)
Host is up (0.00022s latency).
MAC Address: 00:0C:29:90:C9:6F (VMware)
Nmap scan report for tomcat-apache.sait230.ca (10.2.1.6)
Host is up (0.00015s latency).
MAC Address: 00:0C:29:72:36:2B (VMware)
Nmap scan report for bwa.sait230.ca (10.2.1.8)
Host is up (0.00028s latency).
MAC Address: 00:0C:29:4C:6D:F9 (VMware)
Nmap scan report for bt5r3-was.sait230.ca (10.2.1.30)
Host is up.
nexthost: failed to determine route to 10.2.1.32
QUITTING!
\end{lstlisting}

In total I discovered 9 active hosts on the network. All hosts were 
located in the 10.2.1.0/24 subnet.

Next, I used fping\footnote{\label{fping}fping - fping - send ICMP ECHO\_REQUEST packets to network hosts} 
to make sure these hosts were active on the network

\begin{lstlisting}
root@bt-was:~/scans# fping 10.2.1.1 10.2.1.2 10.2.1.3 10.2.1.4 10.2.1.5 10.2.1.6 10.2.1.8
10.2.1.1 is alive
10.2.1.2 is alive
10.2.1.3 is alive
10.2.1.4 is alive
10.2.1.5 is alive
10.2.1.6 is alive
10.2.1.8 is alive
\end{lstlisting}

\csvautotabular{hosts.csv}

\subsubsection{IP Ranges}

Use genlist to generate a list of ip addresses found.

\subsubsection{Domain names}

\csvautotabular{hosts.csv}

\newpage
\subsection{Diagrams and spreadsheets}
\subsection{Tools}

* nmap
* ifconfig

\newpage
\section{Mapping}
\subsection{Open Ports/Services}

Below is a list of open ports and services running. This list was put together using nmap.

\csvautotabular{ports.csv}

My main focus was to identify ports used for hosting web applications and databases. 
The significant open ports to note are 80, 443, 8080, 3306, 5432.

Ports 80, 443 are typically used by web servers for serving HTTP traffic.
8080 is usually used by backend application servers and typically bind to the 127.0.0.1
interface. In the table above we can see that on the bwa host Apache Tomcat is binding 
to interface 0.0.0.0 making it directly accessible from outside the host.

3306 is the default port used by mysql database.
5432 is the default port used by the postgresql database.
Gaining direct access to the database would give us access to the backend data
that the web applications serve data from.

\noindent The following command was used against each host:
\begin{lstlisting}[language=bash, firstline=1, lastline=3]
$ nmap -sV <hostname>

Starting Nmap 7.01 ( https://nmap.org ) at 2016-02-08 12:02 MST
Nmap scan report for localhost (127.0.0.1)
Host is up (0.00036s latency).
Other addresses for localhost (not scanned): ::1
Not shown: 998 closed ports
PORT     STATE SERVICE    VERSION
2222/tcp open  ssh        OpenSSH 5.3 (protocol 2.0)
3000/tcp open  tcpwrapped

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 8.78 seconds

\end{lstlisting}

\subsubsection{metasploitable.sait230.ca}

I chose to spider the metasploitable website to analyze the full site locally 
to try to identify and information leakage in the website.

\begin{lstlisting}[language=bash, firstline=1, lastline=1]
$ wget -r metasploitable.sait230.ca
\end

The above command will recursively download the full metasploitable website. I ran grep
on the downloaded source to try to find some keywords like password.

\begin{lstlisting}[language=bash, firstline=1, lastline=1]
$ grep -rn password metasploitable.sait230.ca/
\end

Here's one snippet that i discovered:

\begin{lstlisting}[language=bash]
metasploitable.sait230.ca/mutillidae/index.php?do=toggle-security&page=user-info.php:2:                 <!-- I think the database password is set to blank or perhaps samurai.
\end{lstlisting}

The above text shows then a client side html comment was left in the code that hints at a possible password for the database.

Another example:

\begin{lstlisting}[language=Bash]
metasploitable.sait230.ca/mutillidae/index.php?page=site-footer-xss-discussion.php:5: It is ok to put the password in HTML comments because no user will ever see 
\end{lstlisting}

The above statement is incorrect. Serverside comments will be rendered on the server
and will be ommitted by most templating engines when producing html. However, it will
not strip out html comments. Html comments can be easily viewed by all browsers. Passwords
and information that gives away details about the backend system should never be
writtin in a code comment.

Next, I opened up the file metasploitable.sait230.ca/mutillidae/index.php and 
found the following code comment at the top of the HTML document.

\begin{lstlisting}[language=HTML]
<!-- I think the database password is set to blank or perhaps samurai.
It depends on whether you installed this web app from irongeeks site or
are using it inside Kevin Johnsons Samurai web testing framework. 
It is ok to put the password in HTML comments because no user will ever see 
this comment. I remember that security instructor saying we should use the
framework comment symbols (ASP.NET, JAVA, PHP, Etc.) 
rather than HTML comments, but we all know those security instructors are 
just making all this up. -->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" 
"http://www.w3.org/TR/19 99/REC-html401-19991224/loose.dtd">
\end{lstlisting}

Next, I ran a nessus scan against this host:

\subsubsection{bwa.sait230.ca}

\subsection{Exploits Available}

\newpage
\section{Discovery}

System vulnerabilities discovered

\csvautotabular{discovery.csv}

Web Application vulnerabilities discovered

\csvautotabular{discovery-webapp.csv}

\subsection{Vulnerabilities for bwa.sait230.ca}

nikto scan:

\begin{lstlisting}[language=Bash]
+ OSVDB-3268: /images/: Directory indexing found.
+ OSVDB-3268: /images/?pattern=/etc/*&sort=name: Directory indexing found.
+ OSVDB-3233: /icons/README: Apache default file found.
+ OSVDB-40478: /tikiwiki/tiki-graph_formula.php?w=1&h=1&s=1&min=1&max=2&f[]=x.tan.phpinfo()&t=png&title=http://cirt.net/rfiinc.txt?: TikiWiki contains a vulnerability which allows remote attackers to execute arbitrary PHP code.
+ /wordpress/: A Wordpress installation was found.
+ /phpmyadmin/: phpMyAdmin directory found
+ 6474 items checked: 2 error(s) and 23 item(s) reported on remote host
+ End Time:           2016-02-12 11:16:58 (GMT-5) (58 seconds)
---------------------------------------------------------------------------
+ 1 host(s) tested
\end{lstlisting}[language=Bash]

\subsection{Vulnerabilities for metasploitable.sait230.ca}

nikto scan:

\begin{lstlisting}[language=Bash]
+ OSVDB-877: HTTP TRACE method is active, suggesting the host is vulnerable to XST
+ OSVDB-3233: /phpinfo.php: Contains PHP configuration information
+ OSVDB-3268: /doc/: Directory indexing found.
+ OSVDB-48: /doc/: The /doc/ directory is browsable. This may be /usr/doc.
+ OSVDB-12184: /index.php?=PHPB8B5F2A0-3C92-11d3-A3A9-4C7B08C10000: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings.
+ OSVDB-3092: /phpMyAdmin/changelog.php: phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts.
+ OSVDB-3092: /phpMyAdmin/: phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts.
+ OSVDB-3268: /test/: Directory indexing found.
+ OSVDB-3092: /test/: This might be interesting...
+ OSVDB-3268: /icons/: Directory indexing found.
+ OSVDB-3233: /icons/README: Apache default file found.
+ /phpMyAdmin/: phpMyAdmin directory found
+ 6474 items checked: 1 error(s) and 15 item(s) reported on remote host
+ End Time:           2016-02-12 11:16:54 (GMT-5) (54 seconds)
---------------------------------------------------------------------------
+ 1 host(s) tested
\end{lstlisting}

\subsection{Vulnerabilities for tomcat-apache.sait230.ca}
nikto scan:

\begin{lstlisting}[language=Bash]
+ Server: Apache/2.2.16 (Debian)
+ Root page / redirects to: http://tomcat-apache.sait230.ca/cp
+ No CGI Directories found (use '-C all' to force check all possible dirs)
+ Apache/2.2.16 appears to be outdated (current is at least Apache/2.2.19). Apache 1.3.42 (final release) and 2.0.64 are also current.
+ OSVDB-3268: /icons/: Directory indexing found.
+ OSVDB-3233: /icons/README: Apache default file found.
+ 6474 items checked: 0 error(s) and 3 item(s) reported on remote host
+ End Time:           2016-02-12 11:16:21 (GMT-5) (21 seconds)
---------------------------------------------------------------------------
+ 1 host(s) tested
\end{lstlisting}

\subsection{Vulnerabilities for ultimatelamp.sait230.ca}
nikto scan:

\begin{lstlisting}[language=Bash]
+ OSVDB-3268: /images/: Directory indexing found.
+ OSVDB-3268: /images/?pattern=/etc/*&sort=name: Directory indexing found.
+ OSVDB-3233: /icons/README: Apache default file found.
+ OSVDB-40478: /tikiwiki/tiki-graph_formula.php?w=1&h=1&s=1&min=1&max=2&f[]=x.tan.phpinfo()&t=png&title=http://cirt.net/rfiinc.txt?: TikiWiki contains a vulnerability which allows remote attackers to execute arbitrary PHP code.
+ /wordpress/: A Wordpress installation was found.
+ /phpmyadmin/: phpMyAdmin directory found
+ 6474 items checked: 3 error(s) and 23 item(s) reported on remote host
+ End Time:           2016-02-12 11:17:30 (GMT-5) (90 seconds)
---------------------------------------------------------------------------
+ 1 host(s) tested
\end{lstlisting}

\subsection{Tools}

* nikto
* sqlmap
* wget -R
* httpprint

\newpage
\section{Exploitation}
\subsection{Exploits for metasploitable.sait230.ca}
\subsection{Exploits for tomcat-apache.sait230.ca}
\subsection{Exploits for bwa.sait230.ca}
\subsection{Exploits for ultimatelamp.sait230.ca}

\newpage
\section{Conclusion}
\subsection{Recommendations}
\subsection{Risk Rating}

\newpage
\section{Appendix A: Vulnerability Detail and Mitigation}
\subsection{Risk Rating Scale}
\subsection{Unprotected WP-Admin Access}
\subsection{Vulnerable Wordpress Search Plugin}

\begin{equation*}
	f(x) = x^2
\end{equation*}

This is some example text\footnote{\label{myfootnote}Hello footnote}.

\begin{figure}[h!]
	\includegraphics[width=\linewidth]{images/screenshot.png}
	\caption{A boat.}
	\label{fig:boat1}
\end{figure}

Figure~\ref{fig:boat1} shows a boat.

\begin{table}[h!]
	\centering
	\caption{Caption for the table.}
	\label{tab:table1}
	\begin{tabular}{l|c||r}
		1 & 2 & 3\\
		\hline
		a & b & c\\
	\end{tabular}
\end{table}

I'm referring to footnote~\ref{myfootnote}.

\begin{table}[h!]
	\centering
	\caption{Caption for the table.}
	\label{tab:table2}
	\begin{tabular}{ccc}
		\toprule
		Some & actual & content\\
		\midrule
		prettifies & the & content\\
		as & well & as\\
		using & the & booktabs package\\
		\bottomrule
	\end{tabular}
\end{table}

\newpage
\begin{table}
	\caption{Dummy table}
\end{table}

\newpage
\begin{table}[h!]
	\begin{center}
		\caption{Autogenerated table from csv file}
\label{table4}
		\pgfplotstabletypeset[
			multicolumn names, % allows to have multicolumn names
			col sep=comma, % the seperator in our .csv file
			display columns/0/.style={column name=$Value 1$, column type={S},string type},
			display columns/1/.style={column name=$Value 2$, column type={S},string type},
			every head row/.style={before row={\toprule}, after row={\si{\ampere} & \si{\volt}\\ \midrule}},
			every last row/.style={after row=\bottomrule}, % rule at bottom
		]{table.csv} % filename/path to file
	\end{center}
\end{table}

\newpage
\begin{figure}[h!]
  \begin{center}
    \begin{tikzpicture}
      \begin{axis}[
          width=\linewidth,
          grid=major,
          grid style={dashed,gray!30},
          xlabel=X Axis $U$,
          ylabel=Y Axis $I$,
          x unit=\si{\volt},
          y unit=\si{\ampere},
          legend style={at={(0.5,-0.2)},anchor=north},
          x tick label style={rotate=90,anchor=east}
        ]
        \addplot
        % select columns by using actual column names in csv.
        table[x=column 1,y=column 2, col sep=comma] {table.csv};
        \legend{Plot}
      \end{axis}
    \end{tikzpicture}
    \caption{My first autogenerated plot.}
  \end{center}
\end{figure}

\newpage
\begin{figure}[h!]
  \begin{center}
    \begin{tikzpicture}
      \draw [red,dashed] (-2.5,2.5) rectangle (-1.5,1.5) node [black,below] {Start};
      \draw [thick] (-2,2)
      to [out=10,in=190] (2,2)
      to [out=10,in=90] (6,0)
      to [out=-90,in=30] (-2,-2);
      \draw [fill] (5,0.1) rectangle (7,-0.1) node [black,right] {Obstacle};
      \draw [red,fill] (-2,-2) circle [radius=0.2] node [black,below=4] {Point of interest}; % draw a circle
    \end{tikzpicture}
    \caption{Example graphic made with tikz.}
  \end{center}
\end{figure}

\newpage
Perl code
\lstinputlisting[language=Perl]{script.pl}

Ruby code
\lstinputlisting[language=Ruby]{script.rb}

Bash script
\lstinputlisting[language=Bash]{script.sh}

\newpage
\begin{appendix}
	\listoffigures
	\listoftables
\end{appendix}

\end{document}
